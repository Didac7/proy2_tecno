import{r as _,o as z,n as B,p as f,q as G,k as m,a as t,c as n,d as r,m as i,t as o,s as y,g as k,F as E,x as S,y as V,j as R,e as q,l as x}from"./app-DEf1IR0b.js";import{A as L}from"./AppLayout-jejGCWhL.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const M={class:"dashboard"},j={key:0,class:"stats-grid"},U={class:"stat-card"},H={class:"stat-info"},W={class:"stat-card"},$={class:"stat-info"},J={class:"stat-card"},K={class:"stat-info"},Q={class:"stat-card"},X={class:"stat-info"},Y={class:"stat-card"},Z={class:"stat-info"},tt={class:"stat-card"},st={class:"stat-info"},et={key:1,class:"gps-widget"},at={class:"gps-card"},ot={key:0,class:"gps-no-vehiculo"},it={key:1},nt={class:"gps-status"},lt={key:0,class:"last-update"},rt={key:0,class:"gps-info"},ct={class:"gps-actions"},dt=["disabled"],ut=["disabled"],vt={key:1,class:"gps-error"},gt={key:2,class:"chart-section"},ft={class:"chart-container"},_t={class:"bar-label"},ht={class:"bar-wrapper"},pt={class:"recent-section"},bt={class:"table-responsive"},mt={class:"data-table"},yt={key:0},kt={key:1},Et={key:2},St={key:3},It={key:0},Pt={key:1},wt={key:2},At={key:3},Dt={__name:"Dashboard",props:{stats:Object,paquetes_recientes:Array,paquetes_por_estado:Array,es_chofer:Boolean},setup(l){const h=l,c=_({tiene_vehiculo:!1,gps_activo:!1,ultima_actualizacion:null,vehiculo:null}),v=_(!1),d=_(null);let u=null,g=null;z(async()=>{h.es_chofer&&await I()}),B(()=>{u&&clearInterval(u),g&&navigator.geolocation.clearWatch(g)});const I=async()=>{try{const e=await f.get("/api/gps/estado");e.data.success&&(c.value=e.data,e.data.gps_activo&&p())}catch(e){console.error("Error al cargar estado GPS:",e)}},P=async()=>{if(!navigator.geolocation){d.value="Tu navegador no soporta geolocalizaciÃ³n";return}v.value=!0,d.value=null;try{const e=await new Promise((a,O)=>{navigator.geolocation.getCurrentPosition(a,O,{enableHighAccuracy:!0,timeout:1e4})});(await f.post("/api/gps/iniciar")).data.success&&(c.value.gps_activo=!0,await b(e.coords.latitude,e.coords.longitude),p())}catch(e){if(e.code)switch(e.code){case e.PERMISSION_DENIED:d.value="Debes permitir el acceso a tu ubicaciÃ³n";break;case e.POSITION_UNAVAILABLE:d.value="No se pudo obtener tu ubicaciÃ³n";break;case e.TIMEOUT:d.value="Tiempo de espera agotado";break}else d.value="Error al iniciar GPS"}finally{v.value=!1}},w=async()=>{v.value=!0,d.value=null;try{(await f.post("/api/gps/finalizar")).data.success&&(c.value.gps_activo=!1,u&&(clearInterval(u),u=null),g&&(navigator.geolocation.clearWatch(g),g=null))}catch{d.value="Error al finalizar GPS"}finally{v.value=!1}},p=()=>{u&&clearInterval(u),u=setInterval(()=>{navigator.geolocation.getCurrentPosition(e=>{b(e.coords.latitude,e.coords.longitude)},e=>{console.error("Error al obtener ubicaciÃ³n:",e)},{enableHighAccuracy:!0,timeout:5e3})},1e4)},b=async(e,s)=>{try{await f.post("/api/gps/actualizar",{latitud:e,longitud:s}),c.value.ultima_actualizacion=new Date().toISOString()}catch(a){console.error("Error al enviar ubicaciÃ³n:",a)}},A=e=>e?new Date(e).toLocaleTimeString("es-BO"):"",D=e=>new Intl.NumberFormat("es-BO").format(e||0),N=e=>e?new Date(e).toLocaleDateString("es-BO"):"-",T=e=>({REGISTRADO:"info",EN_TRANSITO:"warning",ENTREGADO:"success",CANCELADO:"danger"})[e]||"secondary",C=e=>{const s=Math.max(...h.paquetes_por_estado.map(a=>a.total));return e/s*100};return(e,s)=>(i(),G(L,null,{default:m(()=>[t("div",M,[s[22]||(s[22]=t("h1",null,"ðŸ“Š Dashboard - Trans Velasco",-1)),l.es_chofer?r("",!0):(i(),n("div",j,[t("div",U,[s[1]||(s[1]=t("div",{class:"stat-icon"},"ðŸ“¦",-1)),t("div",H,[t("h3",null,o(l.stats.total_paquetes),1),s[0]||(s[0]=t("p",null,"Total Paquetes",-1))])]),t("div",W,[s[3]||(s[3]=t("div",{class:"stat-icon"},"ðŸšš",-1)),t("div",$,[t("h3",null,o(l.stats.paquetes_en_transito),1),s[2]||(s[2]=t("p",null,"En TrÃ¡nsito",-1))])]),t("div",J,[s[5]||(s[5]=t("div",{class:"stat-icon"},"âœ…",-1)),t("div",K,[t("h3",null,o(l.stats.paquetes_entregados),1),s[4]||(s[4]=t("p",null,"Entregados",-1))])]),t("div",Q,[s[7]||(s[7]=t("div",{class:"stat-icon"},"ðŸ‘¥",-1)),t("div",X,[t("h3",null,o(l.stats.total_clientes),1),s[6]||(s[6]=t("p",null,"Clientes",-1))])]),t("div",Y,[s[9]||(s[9]=t("div",{class:"stat-icon"},"ðŸš—",-1)),t("div",Z,[t("h3",null,o(l.stats.vehiculos_activos),1),s[8]||(s[8]=t("p",null,"VehÃ­culos Activos",-1))])]),t("div",tt,[s[11]||(s[11]=t("div",{class:"stat-icon"},"ðŸ’°",-1)),t("div",st,[t("h3",null,"Bs. "+o(D(l.stats.pagos_pendientes)),1),s[10]||(s[10]=t("p",null,"Pagos Pendientes",-1))])])])),e.$page.props.auth.user.tipo_usuario==="CHOFER"?(i(),n("div",et,[s[15]||(s[15]=t("h2",null,"ðŸ“ Rastreo GPS",-1)),t("div",at,[c.value.tiene_vehiculo?(i(),n("div",it,[t("div",nt,[t("div",{class:y(["status-indicator",{active:c.value.gps_activo}])},[s[13]||(s[13]=t("span",{class:"status-dot"},null,-1)),t("span",null,o(c.value.gps_activo?"GPS Activo":"GPS Inactivo"),1)],2),c.value.ultima_actualizacion?(i(),n("div",lt," Ãšltima actualizaciÃ³n: "+o(A(c.value.ultima_actualizacion)),1)):r("",!0)]),c.value.vehiculo?(i(),n("div",rt,[t("p",null,[s[14]||(s[14]=t("strong",null,"VehÃ­culo:",-1)),k(" "+o(c.value.vehiculo.placa)+" - "+o(c.value.vehiculo.modelo),1)])])):r("",!0),t("div",ct,[c.value.gps_activo?(i(),n("button",{key:1,onClick:w,disabled:v.value,class:"btn-gps btn-stop"}," ðŸ Finalizar Viaje ",8,ut)):(i(),n("button",{key:0,onClick:P,disabled:v.value,class:"btn-gps btn-start"}," ðŸšš Iniciar Viaje ",8,dt))]),d.value?(i(),n("div",vt,o(d.value),1)):r("",!0)])):(i(),n("div",ot,[...s[12]||(s[12]=[t("p",null,"âš ï¸ No tienes un vehÃ­culo asignado",-1)])]))])])):r("",!0),l.es_chofer?r("",!0):(i(),n("div",gt,[s[16]||(s[16]=t("h2",null,"ðŸ“ˆ Paquetes por Estado",-1)),t("div",ft,[(i(!0),n(E,null,S(l.paquetes_por_estado,a=>(i(),n("div",{key:a.estado_paquete,class:"chart-bar"},[t("div",_t,o(a.estado_paquete),1),t("div",ht,[t("div",{class:"bar-fill",style:V({width:C(a.total)+"%"})},o(a.total),5)])]))),128))])])),t("div",pt,[t("h2",null,o(l.es_chofer?"ðŸ“¦ Mis Paquetes Asignados":"ðŸ“‹ Paquetes Recientes"),1),t("div",bt,[t("table",mt,[t("thead",null,[t("tr",null,[s[17]||(s[17]=t("th",null,"CÃ³digo",-1)),l.es_chofer?r("",!0):(i(),n("th",yt,"Cliente")),l.es_chofer?(i(),n("th",kt,"Remitente")):r("",!0),l.es_chofer?(i(),n("th",Et,"DescripciÃ³n")):r("",!0),s[18]||(s[18]=t("th",null,"Ruta",-1)),s[19]||(s[19]=t("th",null,"Estado",-1)),s[20]||(s[20]=t("th",null,"Fecha",-1)),l.es_chofer?r("",!0):(i(),n("th",St,"Acciones"))])]),t("tbody",null,[(i(!0),n(E,null,S(l.paquetes_recientes,a=>(i(),n("tr",{key:a.id_paquete},[t("td",null,[t("strong",null,o(a.codigo_seguimiento),1)]),l.es_chofer?r("",!0):(i(),n("td",It,o(a.cliente?.nombre)+" "+o(a.cliente?.apellido),1)),l.es_chofer?(i(),n("td",Pt,o(a.remitente?.nombre)+" "+o(a.remitente?.apellido),1)):r("",!0),l.es_chofer?(i(),n("td",wt,o(a.descripcion_contenido||"Sin descripciÃ³n"),1)):r("",!0),t("td",null,o(a.ruta?.origen?.nombre_destino)+" â†’ "+o(a.ruta?.destino?.nombre_destino),1),t("td",null,[t("span",{class:y("badge badge-"+T(a.estado_paquete))},o(a.estado_paquete),3)]),t("td",null,o(N(a.fecha_registro)),1),l.es_chofer?r("",!0):(i(),n("td",At,[R(q(x),{href:`/paquetes/${a.id_paquete}`,class:"btn-small"},{default:m(()=>[...s[21]||(s[21]=[k(" Ver ",-1)])]),_:1},8,["href"])]))]))),128))])])])])])]),_:1}))}},zt=F(Dt,[["__scopeId","data-v-8b89ae97"]]);export{zt as default};
